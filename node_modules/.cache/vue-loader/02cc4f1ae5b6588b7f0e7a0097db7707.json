{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/alone/VueProjects/one-piece-vue/src/views/permission/user/Index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/views/permission/user/Index.vue","mtime":1597413533825},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js","mtime":1595422850086},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/index.js","mtime":1596109940102}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFNUYWJsZSB9IGZyb20gJ0AvY29tcG9uZW50cycKaW1wb3J0IFVzZXJGb3JtIGZyb20gJy4vY29tcG9uZW50cy9Vc2VyRm9ybScKaW1wb3J0IHsgZmV0Y2hBY2NvdW50LCBkZWxldGVBY2NvdW50LCBjcmVhdGVBY2NvdW50LCB1cGRhdGVBY2NvdW50IH0gZnJvbSAnQC9hcGkvYWRtaW4nCmNvbnN0IGNvbHVtbnMgPSBbCiAgewogICAgdGl0bGU6ICfotKblj7flkI0nLAogICAgZGF0YUluZGV4OiAnbmlja25hbWUnCiAgfSwKICB7CiAgICB0aXRsZTogJ+eZu+W9lei0puWPtycsCiAgICBkYXRhSW5kZXg6ICdhY2NvdW50JwogIH0sCiAgewogICAgdGl0bGU6ICfnirbmgIEnLAogICAgc2NvcGVkU2xvdHM6IHsgY3VzdG9tUmVuZGVyOiAnc3RhdHVzJyB9CiAgfSwKICB7CiAgICB0aXRsZTogJ+abtOaWsOaXtumXtCcsCiAgICBkYXRhSW5kZXg6ICd1cGRhdGVkX2F0JwogIH0sCiAgewogICAgdGl0bGU6ICfliJvlu7rml7bpl7QnLAogICAgZGF0YUluZGV4OiAnY3JlYXRlZF9hdCcKICB9LAogIHsKICAgIHRpdGxlOiAn5pON5L2cJywKICAgIHNjb3BlZFNsb3RzOiB7IGN1c3RvbVJlbmRlcjogJ3Rvb2xzJyB9CiAgfQpdCgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBkZXNjcmlwdGlvbjogJ+WQjuWPsOeuoeeQhui0puWPt+WIl+ihqCcsCiAgICAgIHZpc2libGU6IGZhbHNlLAogICAgICB1c2VyRnJvbVZpc2libGU6IGZhbHNlLAogICAgICBjb25maXJtTG9hZGluZzogZmFsc2UsCiAgICAgIHJ1bGVzOiBbXSwKICAgICAgcm9sZXM6IFtdLAogICAgICBjb2x1bW5zLAogICAgICBzZWxlY3RlSWQ6IDAsCiAgICAgIGxvYWREYXRhOiBwYXJhbWV0ZXIgPT4gewogICAgICAgIHJldHVybiBmZXRjaEFjY291bnQoKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICBjb25zdCB7IHVzZXJzLCBydWxlcywgcm9sZXMgfSA9IHJlcy5kYXRhCiAgICAgICAgICB0aGlzLnJ1bGVzID0gcnVsZXMKICAgICAgICAgIHRoaXMucm9sZXMgPSByb2xlcwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkYXRhOiB1c2VycwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0KICAgIH0KICB9LAogIGNvbXBvbmVudHM6IHsgU1RhYmxlLCBVc2VyRm9ybSB9LAogIG1ldGhvZHM6IHsKICAgIHJlZnJlc2hUYWJsZSAoYm9vbCA9IGZhbHNlKSB7CiAgICAgIHRoaXMuJHJlZnMudGFibGUucmVmcmVzaChib29sKQogICAgfSwKICAgIHNob3dEZWxldGVDb25maXJtIChpZCkgewogICAgICB0aGlzLiRjb25maXJtKHsKICAgICAgICB0aXRsZTogJ+ehruWumuWIoOmZpOatpOeUqOaIt+WQlz8nLAogICAgICAgIGNvbnRlbnQ6ICcnLAogICAgICAgIG9rVGV4dDogJ+ehruWumicsCiAgICAgICAgb2tUeXBlOiAnZGFuZ2VyJywKICAgICAgICBjYW5jZWxUZXh0OiAn5Y+W5raIJywKICAgICAgICBvbk9rOiAoKSA9PiB7CiAgICAgICAgICBjb25zdCBoaWRlID0gdGhpcy4kbWVzc2FnZS5sb2FkaW5nKCfliKDpmaTkuK0uLicsIDApCiAgICAgICAgICBkZWxldGVBY2NvdW50KGlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5Yqf77yBJykKICAgICAgICAgICAgdGhpcy5yZWZyZXNoVGFibGUoKQogICAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgICAgIGhpZGUoKQogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlVXNlckNhbmNlbCgpIHsKICAgICAgICB0aGlzLnVzZXJGcm9tVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgdGhpcy4kcmVmcy51c2VyRm9ybS5mb3JtLnJlc2V0RmllbGRzKCkKICAgICAgICB0aGlzLnNlbGVjdGVkSWQgPSAwCiAgICB9LAogICAgaGFuZGxlVXNlclN1Ym1pdCgpIHsKICAgICAgICB0aGlzLiRyZWZzLnJvbGVGb3JtLmZvcm0udmFsaWRhdGVGaWVsZHMoKGVyciwgdmFsdWVzKSA9PiB7CiAgICAgICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbHVlcykKICAgICAgICAgICAgdGhpcy5zZWxlY3RlZElkID09PSAwID8gY3JlYXRlQWNjb3VudCh2YWx1ZXMpIDogdXBkYXRlQWNjb3VudCh0aGlzLnNlbGVjdGVkSWQsIHZhbHVlcykKICAgICAgICAgICAgLy8gICAgIHRoaXMuY29uZmlybUxvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIC8vICAgICBjb25zdCBoaWRlID0gdGhpcy4kbWVzc2FnZS5sb2FkaW5nKCfmiafooYzkuK0uLicsIDApCiAgICAgICAgICAgIC8vICAgICBwcm9taXNlLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3ModGhpcy5zZWxlY3RlZElkID09PSAwID8gJ+a3u+WKoOaIkOWKn++8gScgOiAn5pu05paw5oiQ5Yqf77yBJykKICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLmhhbmRsZVJvbGVDYW5jZWwoKQogICAgICAgICAgICAvLyAgICAgICAgIHRoaXMucmVmcmVzaFRhYmxlKCkKICAgICAgICAgICAgLy8gICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICAvLyAgICAgICAgIGhpZGUoKQogICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuY29uZmlybUxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9LAoKICAgIGV4cGFuZEljb24gKHsgZXhwYW5kZWQgfSkgewogICAgICBpZiAoZXhwYW5kZWQgPT09IHRydWUpIHsKICAgICAgICByZXR1cm4gPGEtaWNvbiB0eXBlPSdkb3duJyAvPgogICAgICB9CiAgICAgIHJldHVybiA8YS1pY29uIHR5cGU9J3JpZ2h0JyAvPgogICAgfQogIH0KfQo="},{"version":3,"sources":["Index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Index.vue","sourceRoot":"src/views/permission/user","sourcesContent":["<template>\n<page-header-wrapper :content=\"description\">\n\n    <a-card :body-style=\"{ padding: 0 }\">\n        <div class=\"table-operator-right\">\n            <a-button type=\"primary\" icon=\"plus\" @click=\"userFromVisible = true\">新建</a-button>\n            <a-divider type=\"vertical\"/>\n            <span class=\"ant-pro-table-toolbar-item-icon\">\n                <a-tooltip placement=\"top\">\n                <template slot=\"title\">\n                    <span>刷新</span>\n                </template>\n                <a-icon type=\"reload\" @click=\"refreshTable()\"/>\n                </a-tooltip>\n            </span>\n        </div>\n\n        <s-table\n          ref=\"table\"\n          size=\"default\"\n          :rowKey=\"(record) => record.id\"\n          :columns=\"columns\"\n          :data=\"loadData\"\n          :expandRowByClick=\"true\"\n          :showPagination=\"false\"\n          :expandIcon=\"expandIcon\"\n        >\n\n          <template slot=\"status\" slot-scope=\"row\">\n            <template v-if=\"row.status === 1\">\n              <a-badge status=\"processing\" text=\"启用中\"/>\n            </template>\n            <template v-else>\n              <a-badge status=\"default\" text=\"禁用中\"/>\n            </template>\n          </template>\n\n          <template slot=\"expandedRowRender\" slot-scope=\"row\">\n            <a-row>\n              <a-col class=\"rule-list\" span=\"12\" v-for=\"(item, index) in rules\" :key=\"index\">\n                <a-row>\n                  <a-col span=\"4\">{{ item.title }}：</a-col>\n                  <a-col span=\"20\">\n                    <template v-if=\"!item.actions.length\">-</template>\n                    <template v-for=\"(action, i) in item.actions\">\n                      <a-tag :key=\"i\" v-if=\"row.rules.indexOf(action.id) !== -1\">{{ action.title }}</a-tag>\n                    </template>\n                  </a-col>\n                </a-row>\n              </a-col>\n            </a-row>\n          </template>\n\n          <template slot=\"tools\" slot-scope=\"row\">\n            <a\n              @click=\"$router.push({ name: 'UpdateAccountView', params: { id: row.id } })\"\n            >编辑</a>\n            <a-divider type=\"vertical\" />\n            <a @click=\"showDeleteConfirm(row.id)\">删除</a>\n          </template>\n        </s-table>\n\n    </a-card>\n\n    <userForm\n        ref=\"userForm\"\n        :rules=\"rules\"\n        :roles=\"roles\"\n        :visible=\"userFromVisible\"\n        :confirmLoading=\"confirmLoading\"\n        @submit=\"handleUserSubmit\"\n        @cancel=\"handleUserCancel\"\n    />\n\n</page-header-wrapper>\n</template>\n\n<script>\nimport { STable } from '@/components'\nimport UserForm from './components/UserForm'\nimport { fetchAccount, deleteAccount, createAccount, updateAccount } from '@/api/admin'\nconst columns = [\n  {\n    title: '账号名',\n    dataIndex: 'nickname'\n  },\n  {\n    title: '登录账号',\n    dataIndex: 'account'\n  },\n  {\n    title: '状态',\n    scopedSlots: { customRender: 'status' }\n  },\n  {\n    title: '更新时间',\n    dataIndex: 'updated_at'\n  },\n  {\n    title: '创建时间',\n    dataIndex: 'created_at'\n  },\n  {\n    title: '操作',\n    scopedSlots: { customRender: 'tools' }\n  }\n]\n\nexport default {\n  data () {\n    return {\n      description: '后台管理账号列表',\n      visible: false,\n      userFromVisible: false,\n      confirmLoading: false,\n      rules: [],\n      roles: [],\n      columns,\n      selecteId: 0,\n      loadData: parameter => {\n        return fetchAccount().then(res => {\n          const { users, rules, roles } = res.data\n          this.rules = rules\n          this.roles = roles\n          return {\n              data: users\n          }\n        })\n      }\n    }\n  },\n  components: { STable, UserForm },\n  methods: {\n    refreshTable (bool = false) {\n      this.$refs.table.refresh(bool)\n    },\n    showDeleteConfirm (id) {\n      this.$confirm({\n        title: '确定删除此用户吗?',\n        content: '',\n        okText: '确定',\n        okType: 'danger',\n        cancelText: '取消',\n        onOk: () => {\n          const hide = this.$message.loading('删除中..', 0)\n          deleteAccount(id).then(res => {\n            this.$message.success('删除成功！')\n            this.refreshTable()\n          }).finally(() => {\n            hide()\n          })\n        }\n      })\n    },\n    handleUserCancel() {\n        this.userFromVisible = false\n        this.$refs.userForm.form.resetFields()\n        this.selectedId = 0\n    },\n    handleUserSubmit() {\n        this.$refs.roleForm.form.validateFields((err, values) => {\n            if (!err) {\n            console.log(values)\n            this.selectedId === 0 ? createAccount(values) : updateAccount(this.selectedId, values)\n            //     this.confirmLoading = true\n            //     const hide = this.$message.loading('执行中..', 0)\n            //     promise.then(res => {\n            //         this.$message.success(this.selectedId === 0 ? '添加成功！' : '更新成功！')\n            //         this.handleRoleCancel()\n            //         this.refreshTable()\n            //     }).finally(() => {\n            //         hide()\n            //         this.confirmLoading = false\n            //     })\n            }\n        })\n    },\n\n    expandIcon ({ expanded }) {\n      if (expanded === true) {\n        return <a-icon type='down' />\n      }\n      return <a-icon type='right' />\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n\n</style>\n"]}]}