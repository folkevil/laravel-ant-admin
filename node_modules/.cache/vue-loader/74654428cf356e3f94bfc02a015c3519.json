{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/alone/VueProjects/one-piece-vue/src/views/permission/user/Index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/views/permission/user/Index.vue","mtime":1597645033657},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js","mtime":1595422850086},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/index.js","mtime":1596109940102}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFNUYWJsZSB9IGZyb20gJ0AvY29tcG9uZW50cycKaW1wb3J0IFVzZXJGb3JtIGZyb20gJy4vY29tcG9uZW50cy9Vc2VyRm9ybScKaW1wb3J0IHsgZmV0Y2hBY2NvdW50LCBkZWxldGVBY2NvdW50LCBjcmVhdGVBY2NvdW50LCB1cGRhdGVBY2NvdW50IH0gZnJvbSAnQC9hcGkvYWRtaW4nCmNvbnN0IGNvbHVtbnMgPSBbewogICAgICAgIHRpdGxlOiAn5biQ5Y+35pi156ewJywKICAgICAgICBkYXRhSW5kZXg6ICduaWNrbmFtZScKICAgIH0sCiAgICB7CiAgICAgICAgdGl0bGU6ICfnmbvlvZXotKblj7cnLAogICAgICAgIGRhdGFJbmRleDogJ2FjY291bnQnCiAgICB9LAogICAgewogICAgICAgIHRpdGxlOiAn6LSm5Y+36KeS6ImyJywKICAgICAgICBkYXRhSW5kZXg6ICdyb2xlLnRpdGxlJwogICAgfSwKICAgIHsKICAgICAgICB0aXRsZTogJ+i0puWPt+eKtuaAgScsCiAgICAgICAgc2NvcGVkU2xvdHM6IHsgY3VzdG9tUmVuZGVyOiAnc3RhdHVzJyB9CiAgICB9LAogICAgewogICAgICAgIHRpdGxlOiAn5pu05paw5pe26Ze0JywKICAgICAgICBkYXRhSW5kZXg6ICd1cGRhdGVkX2F0JwogICAgfSwKICAgIHsKICAgICAgICB0aXRsZTogJ+WIm+W7uuaXtumXtCcsCiAgICAgICAgZGF0YUluZGV4OiAnY3JlYXRlZF9hdCcKICAgIH0sCiAgICB7CiAgICAgICAgdGl0bGU6ICfmk43kvZwnLAogICAgICAgIHNjb3BlZFNsb3RzOiB7IGN1c3RvbVJlbmRlcjogJ3Rvb2xzJyB9CiAgICB9Cl0KCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGVzY3JpcHRpb246ICflkI7lj7DnrqHnkIbotKblj7fliJfooagnLAogICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgdXNlckZyb21WaXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgY29uZmlybUxvYWRpbmc6IGZhbHNlLAogICAgICAgICAgICBzZWxlY3RlSWQ6IDAsCiAgICAgICAgICAgIHJ1bGVzOiBbXSwKICAgICAgICAgICAgcm9sZXM6IFtdLAogICAgICAgICAgICBjb2x1bW5zLAogICAgICAgICAgICB1c2VyRm9ybVRpdGxlOiAn5paw5bu6JywKICAgICAgICAgICAgbG9hZERhdGE6IHBhcmFtZXRlciA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hBY2NvdW50KCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdXNlcnMsIHJ1bGVzLCByb2xlcyB9ID0gcmVzLmRhdGEKICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1bGVzID0gcnVsZXMKICAgICAgICAgICAgICAgICAgICB0aGlzLnJvbGVzID0gcm9sZXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB1c2VycwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgY29tcG9uZW50czogeyBTVGFibGUsIFVzZXJGb3JtIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgcmVmcmVzaFRhYmxlKGJvb2wgPSBmYWxzZSkgewogICAgICAgICAgICB0aGlzLiRyZWZzLnRhYmxlLnJlZnJlc2goYm9vbCkKICAgICAgICB9LAogICAgICAgIHNob3dEZWxldGVDb25maXJtKGlkKSB7CiAgICAgICAgICAgIHRoaXMuJGNvbmZpcm0oewogICAgICAgICAgICAgICAgdGl0bGU6ICfnoa7lrprliKDpmaTmraTnlKjmiLflkJc/JywKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnLAogICAgICAgICAgICAgICAgb2tUZXh0OiAn56Gu5a6aJywKICAgICAgICAgICAgICAgIG9rVHlwZTogJ2RhbmdlcicsCiAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiAn5Y+W5raIJywKICAgICAgICAgICAgICAgIG9uT2s6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoaWRlID0gdGhpcy4kbWVzc2FnZS5sb2FkaW5nKCfliKDpmaTkuK0uLicsIDApCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlQWNjb3VudChpZCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WIoOmZpOaIkOWKn++8gScpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaFRhYmxlKCkKICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGhhbmRsZVVzZXJDYW5jZWwoKSB7CiAgICAgICAgICAgIHRoaXMudXNlckZyb21WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgdGhpcy4kcmVmcy51c2VyRm9ybS5mb3JtLnJlc2V0RmllbGRzKCkKICAgICAgICAgICAgdGhpcy5zZWxlY3RlSWQgPSAwCiAgICAgICAgfSwKICAgICAgICBoYW5kbGVVc2VyU3VibWl0KCkgewogICAgICAgICAgICB0aGlzLiRyZWZzLnVzZXJGb3JtLmZvcm0udmFsaWRhdGVGaWVsZHMoKGVyciwgdmFsdWVzKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWVycikgewogICAgICAgICAgICAgICAgICAgICF2YWx1ZXMucGFzc3dvcmQgJiYgZGVsZXRlIHZhbHVlcy5wYXNzd29yZAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd2YWx1ZXMnLCB2YWx1ZXMpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuc2VsZWN0ZUlkID09PSAwID8gY3JlYXRlQWNjb3VudCh2YWx1ZXMpIDogdXBkYXRlQWNjb3VudCh0aGlzLnNlbGVjdGVJZCwgdmFsdWVzKQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3ModGhpcy5zZWxlY3RlSWQgPT09IDAgPyAn5re75Yqg5oiQ5Yqf77yBJyA6ICfmm7TmlrDmiJDlip/vvIEnKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVVzZXJDYW5jZWwoKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hUYWJsZSgpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgICAgICBlZGl0VXNlckZvcm0ocm93KSB7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZUlkID0gcm93LmlkCiAgICAgICAgICAgIHRoaXMudXNlckZyb21WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICB0aGlzLnVzZXJGb3JtVGl0bGUgPSAn57yW6L6RJwogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLnVzZXJGb3JtLmZvcm0uc2V0RmllbGRzVmFsdWUoewogICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHJvdy5hY2NvdW50LAogICAgICAgICAgICAgICAgICAgIG5pY2tuYW1lOiByb3cubmlja25hbWUsCiAgICAgICAgICAgICAgICAgICAgcm9sZV9pZDogcm93LnJvbGVfaWQsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByb3cuc3RhdHVzCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KQogICAgICAgIH0sCgogICAgICAgIGV4cGFuZEljb24oeyBleHBhbmRlZCB9KSB7CiAgICAgICAgICAgIGlmIChleHBhbmRlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDxhLWljb24gdHlwZSA9ICdkb3duJyAvPgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiA8YS1pY29uIHR5cGUgPSAncmlnaHQnIC8+CiAgICAgICAgfQogICAgfQp9Cg=="},{"version":3,"sources":["Index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Index.vue","sourceRoot":"src/views/permission/user","sourcesContent":["<template>\n    <page-header-wrapper :content=\"description\">\n        <a-card :body-style=\"{ padding: 0 }\">\n            <div class=\"table-operator-right\">\n                <a-button v-action:addAdmin type=\"primary\" icon=\"plus\" @click=\"userFromVisible = true\">新建</a-button>\n                <a-divider type=\"vertical\" />\n                <span class=\"ant-pro-table-toolbar-item-icon\">\n                    <a-tooltip placement=\"top\">\n                        <template slot=\"title\">\n                            <span>刷新</span>\n                        </template>\n                        <a-icon type=\"reload\" @click=\"refreshTable()\"/>\n                    </a-tooltip>\n                </span>\n            </div>\n\n            <s-table\n            ref=\"table\"\n            size=\"default\"\n            :rowKey=\"(record) => record.id\"\n            :columns=\"columns\"\n            :data=\"loadData\"\n            :expandRowByClick=\"true\"\n            :showPagination=\"false\"\n            :expandIcon=\"expandIcon\"\n            >\n                <template slot=\"status\" slot-scope=\"row\">\n                    <template v-if=\"row.status === 1\">\n                        <a-badge status=\"processing\" text=\"启用中\"/>\n                    </template>\n\n                    <template v-else>\n                        <a-badge status=\"default\" text=\"禁用中\" />\n                    </template>\n                </template>\n\n                <template slot=\"expandedRowRender\" slot-scope=\"row\">\n                    <a-row>\n                        <a-col class=\"rule-list\" span=\"12\" v-for=\"(item, index) in rules\" :key=\"index\">\n                            <a-row>\n                                <a-col span=\"4\">{{ item.title }}：</a-col>\n                                <a-col span=\"20\">\n                                    <template v-if=\"!item.actions.length\">-</template>\n\n                                    <template v-for=\"(action, i) in item.actions\">\n                                        <a-tag color=\"blue\" :key=\"i\" v-if=\"row.rules.indexOf(action.id) !== -1\">\n                                            {{ action.title }}\n                                        </a-tag>\n                                        <a-tag :key=\"i\" v-else>\n                                            {{ action.title }}\n                                        </a-tag>\n                                    </template>\n                                </a-col>\n                            </a-row>\n                        </a-col>\n                    </a-row>\n                </template>\n\n                <template slot=\"tools\" slot-scope=\"row\">\n                    <a v-action:editAdmin @click=\"editUserForm(row)\">编辑</a>\n                    <a-divider type=\"vertical\" />\n                    <a v-action:deleteAdmin @click=\"showDeleteConfirm(row.id)\">删除</a>\n                </template>\n            </s-table>\n\n        </a-card>\n\n        <userForm\n            ref=\"userForm\"\n            :title=\"userFormTitle\"\n            :rules=\"rules\"\n            :roles=\"roles\"\n            :selecteId=\"selecteId\"\n            :visible=\"userFromVisible\"\n            :confirmLoading=\"confirmLoading\"\n            @submit=\"handleUserSubmit\"\n            @cancel=\"handleUserCancel\"\n        />\n\n    </page-header-wrapper>\n</template>\n\n<script>\nimport { STable } from '@/components'\nimport UserForm from './components/UserForm'\nimport { fetchAccount, deleteAccount, createAccount, updateAccount } from '@/api/admin'\nconst columns = [{\n        title: '帐号昵称',\n        dataIndex: 'nickname'\n    },\n    {\n        title: '登录账号',\n        dataIndex: 'account'\n    },\n    {\n        title: '账号角色',\n        dataIndex: 'role.title'\n    },\n    {\n        title: '账号状态',\n        scopedSlots: { customRender: 'status' }\n    },\n    {\n        title: '更新时间',\n        dataIndex: 'updated_at'\n    },\n    {\n        title: '创建时间',\n        dataIndex: 'created_at'\n    },\n    {\n        title: '操作',\n        scopedSlots: { customRender: 'tools' }\n    }\n]\n\nexport default {\n    data() {\n        return {\n            description: '后台管理账号列表',\n            visible: false,\n            userFromVisible: false,\n            confirmLoading: false,\n            selecteId: 0,\n            rules: [],\n            roles: [],\n            columns,\n            userFormTitle: '新建',\n            loadData: parameter => {\n                return fetchAccount().then(res => {\n                    const { users, rules, roles } = res.data\n                    this.rules = rules\n                    this.roles = roles\n                    return {\n                        data: users\n                    }\n                })\n            }\n        }\n    },\n    components: { STable, UserForm },\n    methods: {\n        refreshTable(bool = false) {\n            this.$refs.table.refresh(bool)\n        },\n        showDeleteConfirm(id) {\n            this.$confirm({\n                title: '确定删除此用户吗?',\n                content: '',\n                okText: '确定',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: () => {\n                    const hide = this.$message.loading('删除中..', 0)\n                    deleteAccount(id).then(res => {\n                        this.$message.success('删除成功！')\n                        this.refreshTable()\n                    }).finally(() => {\n                        hide()\n                    })\n                }\n            })\n        },\n        handleUserCancel() {\n            this.userFromVisible = false\n            this.$refs.userForm.form.resetFields()\n            this.selecteId = 0\n        },\n        handleUserSubmit() {\n            this.$refs.userForm.form.validateFields((err, values) => {\n                if (!err) {\n                    !values.password && delete values.password\n                    console.log('values', values)\n                    const request = this.selecteId === 0 ? createAccount(values) : updateAccount(this.selecteId, values)\n                    request.then(res => {\n                        this.$message.success(this.selecteId === 0 ? '添加成功！' : '更新成功！')\n                        this.handleUserCancel()\n                        this.refreshTable()\n                    })\n                }\n            })\n        },\n\n        editUserForm(row) {\n            this.selecteId = row.id\n            this.userFromVisible = true\n            this.userFormTitle = '编辑'\n            this.$nextTick(() => {\n                this.$refs.userForm.form.setFieldsValue({\n                    account: row.account,\n                    nickname: row.nickname,\n                    role_id: row.role_id,\n                    status: row.status\n                })\n            })\n        },\n\n        expandIcon({ expanded }) {\n            if (expanded === true) {\n                return <a-icon type = 'down' />\n            }\n            return <a-icon type = 'right' />\n        }\n    }\n}\n</script>\n\n<style lang=\"less\">\n\n</style>\n"]}]}