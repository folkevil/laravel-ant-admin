{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/alone/VueProjects/one-piece-vue/src/views/permission/menu/Index.vue?vue&type=style&index=0&id=44ca6d98&scoped=true&lang=css&","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/views/permission/menu/Index.vue","mtime":1597393027845},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/css-loader/dist/cjs.js","mtime":1596109946494},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1596109940102},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/postcss-loader/src/index.js","mtime":1595423035501},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/vue-loader/lib/index.js","mtime":1596109940102}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5ydWxlLWxpc3QgewogICAgcGFkZGluZy1sZWZ0OiAxMnB4OwogICAgcGFkZGluZy1yaWdodDogMTJweDsKICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICBtaW4taGVpZ2h0OiAyM3B4Owp9Cg=="},{"version":3,"sources":["Index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4TA;AACA;AACA;AACA;AACA;AACA","file":"Index.vue","sourceRoot":"src/views/permission/menu","sourcesContent":["<template>\n    <page-header-wrapper :content=\"description\">\n        <a-card :body-style=\"{ padding: 0 }\">\n            <div class=\"table-operator-right\">\n                <a-button v-action:addPermission type=\"primary\" icon=\"plus\" @click=\"visible = true\">新建</a-button>\n                <a-divider type=\"vertical\"/>\n                <span class=\"ant-pro-table-toolbar-item-icon\">\n                    <a-tooltip placement=\"top\">\n                    <template slot=\"title\">\n                        <span>刷新</span>\n                    </template>\n                    <a-icon type=\"reload\" @click=\"refreshTable()\"/>\n                    </a-tooltip>\n                </span>\n            </div>\n            <s-table\n                ref=\"table\"\n                size=\"default\"\n                :rowKey=\"(record) => record.id\"\n                :columns=\"columns\"\n                :data=\"loadData\"\n                :showPagination=\"false\"\n                :defaultExpandedRowKeys=\"expandedKeys\"\n                :rowSelection=\"{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }\"\n            >\n                <template slot=\"actions\" slot-scope=\"row\">\n                    <template v-if=\"row.type !== 'menu'\">-</template>\n                    <template v-for=\"(action, index) in row.actions\" v-else>\n                        <a-popover :key=\"index\" title=\"详情\" trigger=\"hover\">\n                            <template slot=\"content\">\n                                <div style=\"margin-bottom:15px\">唯一识别码: {{ action.name }}</div>\n                                <a-button\n                                    v-action:editPermission\n                                    size=\"small\"\n                                    type=\"primary\"\n                                    ghost\n                                    @click=\"showActionModal(action)\"\n                                    style=\"margin-right:10px\"\n                                >编辑</a-button>\n                                <a-button v-action:deletePermission size=\"small\" type=\"danger\" ghost @click=\"showDeleteConfirm(action.id)\">删除</a-button>\n                            </template>\n                            <a-tag>{{ action.title }}</a-tag>\n                        </a-popover>\n                    </template>\n                </template>\n\n                <template slot=\"icon\" slot-scope=\"row\">\n                    <a-icon :type=\"row.icon\" v-if=\"row.icon\" />\n                    {{ row.icon }}\n                </template>\n\n                <template slot=\"type\" slot-scope=\"row\">\n                    <a-tag :color=\"row.type | typeColorFilter\">\n                        {{ row.type | typeTextFilter }}\n                    </a-tag>\n                </template>\n\n                <template slot=\"status\" slot-scope=\"row\">\n                    <a-badge :status=\"row.status | statusTypeFilter\" :text=\"row.status | statusFilter\" />\n                </template>\n\n                <template slot=\"weight\" slot-scope=\"row\">\n                    <span>{{ row.weight }}</span>\n                </template>\n\n                <template slot=\"tools\" slot-scope=\"row\">\n                    <a v-action:addPermission @click=\"showAddModal(row)\" :disabled=\"row.type === 'action'\">新建</a>\n                    <a-divider type=\"vertical\" />\n                    <a v-action:editPermission @click=\"showActionModal(row)\">编辑</a>\n                    <a-divider type=\"vertical\" />\n                    <a v-action:deletePermission @click=\"showDeleteConfirm(row.id)\" :disabled=\"row.name === 'Index'\">删除</a>\n                </template>\n            </s-table>\n        </a-card>\n\n        <PermissionForm\n            ref=\"permissionForm\"\n            :visible=\"visible\"\n            :selected=\"selected\"\n            :status=\"status\"\n            :typeMap=\"typeMap\"\n            :treeData=\"roleTree\"\n            :confirmLoading=\"confirmLoading\"\n            @submit=\"handleSubmit\"\n            @cancel=\"handleCancel\"\n        />\n    </page-header-wrapper>\n</template>\n\n<script>\nimport { STable } from '@/components'\nimport PermissionForm from './components/PermissionForm'\nimport { fetchPermission, addPermission, updatePermission, deletePermission } from '@/api/permission'\nconst status = [{ label: '是', value: 1 }, { label: '否', value: 0 }]\nconst statusMap = {\n    0: {\n        status: 'default',\n        text: '已禁用'\n    },\n    1: {\n        status: 'processing',\n        text: '使用中'\n    }\n}\nconst typeMap = {\n    'path': {\n        value: 'path',\n        text: '目录',\n        color: 'gold'\n    },\n    'menu': {\n        value: 'menu',\n        text: '菜单',\n        color: 'blue'\n    },\n    'action': {\n        value: 'action',\n        text: '按钮',\n        color: 'cyan'\n    }\n}\nconst columns = [\n    {\n        title: '菜单名称',\n        dataIndex: 'title'\n    },\n    {\n        title: '唯一识别码',\n        dataIndex: 'name'\n    },\n    {\n        title: '菜单 ICON',\n        scopedSlots: { customRender: 'icon' }\n    },\n    {\n        title: '可操作权限',\n        scopedSlots: { customRender: 'actions' }\n    },\n    {\n        title: '类型',\n        scopedSlots: { customRender: 'type' }\n    },\n    {\n        title: '状态',\n        scopedSlots: { customRender: 'status' }\n    },\n    {\n        title: '权重',\n        scopedSlots: { customRender: 'weight' }\n    },\n    {\n        title: '操作',\n        scopedSlots: { customRender: 'tools' }\n    }\n]\nexport default {\n    data() {\n        return {\n            description: '列表使用场景：后台管理中的权限管理以及角色管理，可用于基于 RBAC 设计的角色权限控制，颗粒度细到每一个操作类型。',\n            columns,\n            typeMap,\n            status,\n            expandedKeys: [],\n            queryParam: {},\n            loadData: parameter => {\n                return fetchPermission().then(res => {\n                    res = res.data\n                    const { tree, data } = res\n                    this.roleTree = tree\n                    // 展开所有\n                    this.expandedRow(data)\n                    return res\n                })\n            },\n            loading: false,\n            visible: false,\n            confirmLoading: false,\n            info: {},\n            roleTree: [],\n            selected: 0,\n            selectedRowKeys: [],\n            selectedRows: []\n        }\n    },\n    components: { STable, PermissionForm },\n    filters: {\n        statusFilter(type) {\n            return statusMap[type].text\n        },\n        statusTypeFilter(type) {\n            return statusMap[type].status\n        },\n        typeTextFilter(type) {\n            return typeMap[type].text\n        },\n        typeColorFilter(type) {\n            return typeMap[type].color\n        }\n    },\n    methods: {\n        showActionModal(row) {\n            this.visible = true\n            this.selected = row.id\n            this.$nextTick(() => {\n                this.$refs.permissionForm.form.setFieldsValue({\n                    type: row.type,\n                    title: row.title,\n                    name: row.name,\n                    component: row.component,\n                    path: row.path,\n                    pid: row.pid.toString(),\n                    redirect: row.redirect,\n                    status: row.status,\n                    keepAlive: row.keepAlive,\n                    hidden: row.hidden,\n                    hideChildrenInMenu: row.hideChildrenInMenu,\n                    icon: row.icon,\n                    permission: row.permission ? row.permission.split(',') : [],\n                    action_type: row.action_type,\n                    button_type: row.button_type,\n                    weight: row.weight\n                })\n            })\n        },\n        showAddModal(row) {\n            this.visible = true\n            // this.selected = row.id\n            this.$nextTick(() => {\n                this.$refs.permissionForm.form.setFieldsValue({\n                    pid: row.id.toString()\n                })\n            })\n        },\n        handleSubmit() {\n            this.$refs.permissionForm.form.validateFields((err, values) => {\n                if (!err) {\n                    this.confirmLoading = true\n                    const promise = this.selected === 0 ? addPermission(values) : updatePermission(this.selected, values)\n                    const hide = this.$message.loading('执行中..', 0)\n                    promise.then(res => {\n                        this.$message.success(this.selected === 0 ? '添加成功！' : '更新成功！')\n                        this.refreshTable()\n                        this.handleCancel()\n                        this.$store.dispatch('ReloadRouters')\n                    }).finally(() => {\n                        hide()\n                        this.confirmLoading = false\n                    })\n                }\n            })\n        },\n\n        handleCancel() {\n            this.visible = false\n            this.selected = 0\n            this.$refs.permissionForm.form.resetFields()\n        },\n        showDeleteConfirm(id) {\n            this.$confirm({\n                title: '确定删除此规则吗?',\n                content: '',\n                okText: '确定',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: () => {\n                    const hide = this.$message.loading('删除中..', 0)\n                    deletePermission(id).then(res => {\n                        this.$message.success('删除成功！')\n                        this.refreshTable()\n                        this.$store.dispatch('ReloadRouters')\n                    }).finally(() => {\n                        hide()\n                        this.updating = false\n                    })\n                }\n            })\n        },\n        refreshTable() {\n            this.$refs.table.refresh()\n        },\n        onSelectChange(selectedRowKeys, selectedRows) {\n            this.selectedRowKeys = selectedRowKeys\n            this.selectedRows = selectedRows\n        },\n        handleMenuClick({ key }) {\n            switch (key) {\n                case 'remove':\n                    {\n                        // TODO\n                    }\n            }\n        },\n        handleTreeChange(v) {\n            if (v === '0') {\n                // TODO 当选择‘根’时，类型不能选择按钮\n            }\n        },\n        expandedRow(data) {\n            data.map(item => {\n                this.expandedKeys.push(item.id)\n                if (item.children !== undefined) {\n                    this.expandedRow(item.children)\n                }\n            })\n        },\n        onActionChange(action) {\n            this.form.setFieldsValue({\n                title: this.actions[action].label,\n                name: this.actions[action].key\n            })\n        }\n    }\n}\n</script>\n\n<style scoped>\n.rule-list {\n    padding-left: 12px;\n    padding-right: 12px;\n    margin-bottom: 12px;\n    min-height: 23px;\n}\n</style>\n"]}]}