{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js!/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/alone/VueProjects/one-piece-vue/src/store/modules/user.js","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/store/modules/user.js","mtime":1596624522022},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js","mtime":1595422850086},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js","mtime":1595422972371}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgc3RvcmFnZSBmcm9tICdzdG9yZSc7CmltcG9ydCB7IGxvZ2luLCBsb2dvdXQsIGdldEluZm8gfSBmcm9tICdAL2FwaS9sb2dpbic7CmltcG9ydCB7IEFDQ0VTU19UT0tFTiB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOwppbXBvcnQgeyB3ZWxjb21lIH0gZnJvbSAnQC91dGlscy91dGlsJzsKdmFyIHVzZXIgPSB7CiAgc3RhdGU6IHsKICAgIHRva2VuOiAnJywKICAgIG5hbWU6ICcnLAogICAgd2VsY29tZTogJycsCiAgICBhdmF0YXI6ICcnLAogICAgcm9sZXM6IFtdLAogICAgaW5mbzoge30sCiAgICBwZXJtaXNzaW9uczogW10KICB9LAogIG11dGF0aW9uczogewogICAgU0VUX1RPS0VOOiBmdW5jdGlvbiBTRVRfVE9LRU4oc3RhdGUsIHRva2VuKSB7CiAgICAgIHN0YXRlLnRva2VuID0gdG9rZW47CiAgICB9LAogICAgU0VUX05BTUU6IGZ1bmN0aW9uIFNFVF9OQU1FKHN0YXRlLCBuYW1lKSB7CiAgICAgIHN0YXRlLm5hbWUgPSBuYW1lOwogICAgfSwKICAgIFNFVF9BVkFUQVI6IGZ1bmN0aW9uIFNFVF9BVkFUQVIoc3RhdGUsIGF2YXRhcikgewogICAgICBzdGF0ZS5hdmF0YXIgPSBhdmF0YXI7CiAgICB9LAogICAgU0VUX1JPTEVTOiBmdW5jdGlvbiBTRVRfUk9MRVMoc3RhdGUsIHJvbGVzKSB7CiAgICAgIHN0YXRlLnJvbGVzID0gcm9sZXM7CiAgICB9LAogICAgU0VUX1BFUk1JU1NJT05TOiBmdW5jdGlvbiBTRVRfUEVSTUlTU0lPTlMoc3RhdGUsIHBlcm1pc3Npb25zKSB7CiAgICAgIHN0YXRlLnBlcm1pc3Npb25zID0gcGVybWlzc2lvbnM7CiAgICB9LAogICAgU0VUX1dFTENPTUU6IGZ1bmN0aW9uIFNFVF9XRUxDT01FKHN0YXRlLCB3ZWxjb21lKSB7CiAgICAgIHN0YXRlLndlbGNvbWUgPSB3ZWxjb21lOwogICAgfSwKICAgIFNFVF9JTkZPOiBmdW5jdGlvbiBTRVRfSU5GTyhzdGF0ZSwgaW5mbykgewogICAgICBzdGF0ZS5pbmZvID0gaW5mbzsKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIC8vIOeZu+W9lQogICAgTG9naW46IGZ1bmN0aW9uIExvZ2luKF9yZWYsIHVzZXJJbmZvKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBsb2dpbih1c2VySW5mbykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgc3RvcmFnZS5zZXQoQUNDRVNTX1RPS0VOLCByZXN1bHQuYWNjZXNzX3Rva2VuLCByZXN1bHQuZXhwaXJlc19pbik7CiAgICAgICAgICBjb21taXQoJ1NFVF9UT0tFTicsIHJlc3VsdC5hY2Nlc3NfdG9rZW4pOwogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgLy8g6I635Y+W55So5oi35L+h5oGvCiAgICBHZXRJbmZvOiBmdW5jdGlvbiBHZXRJbmZvKF9yZWYyKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmMi5jb21taXQ7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgZ2V0SW5mbygpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgICBpZiAocmVzdWx0LnBlcm1pc3Npb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gcmVzdWx0LnBlcm1pc3Npb25zOwogICAgICAgICAgICBwZXJtaXNzaW9ucyA9IHBlcm1pc3Npb25zLm1hcChmdW5jdGlvbiAocGVyKSB7CiAgICAgICAgICAgICAgaWYgKHBlci5hY3Rpb25FbnRpdHlTZXQgIT0gbnVsbCAmJiBwZXIuYWN0aW9uRW50aXR5U2V0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSBwZXIuYWN0aW9uRW50aXR5U2V0Lm1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24uYWN0aW9uOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBwZXIuYWN0aW9uTGlzdCA9IGFjdGlvbjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBwZXI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb21taXQoJ1NFVF9QRVJNSVNTSU9OUycsIHBlcm1pc3Npb25zKTsKICAgICAgICAgICAgY29tbWl0KCdTRVRfUk9MRVMnLCByZXN1bHQucm9sZXMpOwogICAgICAgICAgICBjb21taXQoJ1NFVF9JTkZPJywgcmVzdWx0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ2dldEluZm86IHBlcm1pc3Npb25zIG11c3QgYmUgYSBub24tbnVsbCBhcnJheSAhJykpOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbW1pdCgnU0VUX05BTUUnLCByZXN1bHQubmlja25hbWUpOwogICAgICAgICAgY29tbWl0KCdTRVRfV0VMQ09NRScsIHdlbGNvbWUoKSk7CiAgICAgICAgICBjb21taXQoJ1NFVF9BVkFUQVInLCByZXN1bHQuYXZhdGFyKTsKICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgLy8g55m75Ye6CiAgICBMb2dvdXQ6IGZ1bmN0aW9uIExvZ291dChfcmVmMykgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjMuY29tbWl0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBsb2dvdXQoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHJlc29sdmUoZXJyb3IpOwogICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tbWl0KCdTRVRfVE9LRU4nLCAnJyk7CiAgICAgICAgICBjb21taXQoJ1NFVF9ST0xFUycsIFtdKTsKICAgICAgICAgIGNvbW1pdCgnU0VUX1BFUk1JU1NJT05TJywgW10pOwogICAgICAgICAgc3RvcmFnZS5yZW1vdmUoQUNDRVNTX1RPS0VOKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfQp9OwpleHBvcnQgZGVmYXVsdCB1c2VyOw=="},{"version":3,"sources":["/Users/alone/VueProjects/one-piece-vue/src/store/modules/user.js"],"names":["storage","login","logout","getInfo","ACCESS_TOKEN","welcome","user","state","token","name","avatar","roles","info","permissions","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_PERMISSIONS","SET_WELCOME","SET_INFO","actions","Login","userInfo","commit","Promise","resolve","reject","then","response","result","data","set","access_token","expires_in","catch","error","GetInfo","length","map","per","actionEntitySet","action","actionList","Error","nickname","Logout","finally","remove"],"mappings":";;;AAAA,OAAOA,OAAP,MAAoB,OAApB;AACA,SACIC,KADJ,EAEIC,MAFJ,EAGIC,OAHJ,QAIO,aAJP;AAKA,SACIC,YADJ,QAEO,wBAFP;AAGA,SACIC,OADJ,QAEO,cAFP;AAIA,IAAMC,IAAI,GAAG;AACTC,EAAAA,KAAK,EAAE;AACHC,IAAAA,KAAK,EAAE,EADJ;AAEHC,IAAAA,IAAI,EAAE,EAFH;AAGHJ,IAAAA,OAAO,EAAE,EAHN;AAIHK,IAAAA,MAAM,EAAE,EAJL;AAKHC,IAAAA,KAAK,EAAE,EALJ;AAMHC,IAAAA,IAAI,EAAE,EANH;AAOHC,IAAAA,WAAW,EAAE;AAPV,GADE;AAWTC,EAAAA,SAAS,EAAE;AACPC,IAAAA,SAAS,EAAE,mBAACR,KAAD,EAAQC,KAAR,EAAkB;AACzBD,MAAAA,KAAK,CAACC,KAAN,GAAcA,KAAd;AACH,KAHM;AAIPQ,IAAAA,QAAQ,EAAE,kBAACT,KAAD,EAAQE,IAAR,EAAiB;AACvBF,MAAAA,KAAK,CAACE,IAAN,GAAaA,IAAb;AACH,KANM;AAOPQ,IAAAA,UAAU,EAAE,oBAACV,KAAD,EAAQG,MAAR,EAAmB;AAC3BH,MAAAA,KAAK,CAACG,MAAN,GAAeA,MAAf;AACH,KATM;AAUPQ,IAAAA,SAAS,EAAE,mBAACX,KAAD,EAAQI,KAAR,EAAkB;AACzBJ,MAAAA,KAAK,CAACI,KAAN,GAAcA,KAAd;AACH,KAZM;AAaPQ,IAAAA,eAAe,EAAE,yBAACZ,KAAD,EAAQM,WAAR,EAAwB;AACrCN,MAAAA,KAAK,CAACM,WAAN,GAAoBA,WAApB;AACH,KAfM;AAgBPO,IAAAA,WAAW,EAAE,qBAACb,KAAD,EAAQF,OAAR,EAAoB;AAC7BE,MAAAA,KAAK,CAACF,OAAN,GAAgBA,OAAhB;AACH,KAlBM;AAmBPgB,IAAAA,QAAQ,EAAE,kBAACd,KAAD,EAAQK,IAAR,EAAiB;AACvBL,MAAAA,KAAK,CAACK,IAAN,GAAaA,IAAb;AACH;AArBM,GAXF;AAmCTU,EAAAA,OAAO,EAAE;AACL;AACAC,IAAAA,KAFK,uBAIFC,QAJE,EAIQ;AAAA,UADTC,MACS,QADTA,MACS;AACT,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC3B,QAAAA,KAAK,CAACuB,QAAD,CAAL,CACKK,IADL,CACU,UAAAC,QAAQ,EAAI;AACd,cAAMC,MAAM,GAAGD,QAAQ,CAACE,IAAxB;AACAhC,UAAAA,OAAO,CAACiC,GAAR,CAAY7B,YAAZ,EAA0B2B,MAAM,CAACG,YAAjC,EAA+CH,MAAM,CAACI,UAAtD;AACAV,UAAAA,MAAM,CAAC,WAAD,EAAcM,MAAM,CAACG,YAArB,CAAN;AACAP,UAAAA,OAAO;AACV,SANL,EAOKS,KAPL,CAOW,UAAAC,KAAK,EAAI;AACZT,UAAAA,MAAM,CAACS,KAAD,CAAN;AACH,SATL;AAUH,OAXM,CAAP;AAYH,KAjBI;AAmBL;AACAC,IAAAA,OApBK,0BAsBF;AAAA,UADCb,MACD,SADCA,MACD;AACC,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCzB,QAAAA,OAAO,GACF0B,IADL,CACU,UAAAC,QAAQ,EAAI;AACd,cAAMC,MAAM,GAAGD,QAAQ,CAACE,IAAxB;;AAEA,cAAID,MAAM,CAAClB,WAAP,CAAmB0B,MAAnB,GAA4B,CAAhC,EAAmC;AAC/B,gBAAI1B,WAAW,GAAGkB,MAAM,CAAClB,WAAzB;AAEAA,YAAAA,WAAW,GAAGA,WAAW,CAAC2B,GAAZ,CAAgB,UAAAC,GAAG,EAAI;AACjC,kBAAIA,GAAG,CAACC,eAAJ,IAAuB,IAAvB,IAA+BD,GAAG,CAACC,eAAJ,CAAoBH,MAApB,GAA6B,CAAhE,EAAmE;AAC/D,oBAAMI,MAAM,GAAGF,GAAG,CAACC,eAAJ,CAAoBF,GAApB,CAAwB,UAAAG,MAAM,EAAI;AAC7C,yBAAOA,MAAM,CAACA,MAAd;AACH,iBAFc,CAAf;AAGAF,gBAAAA,GAAG,CAACG,UAAJ,GAAiBD,MAAjB;AACH;;AACD,qBAAOF,GAAP;AACH,aARa,CAAd;AAUAhB,YAAAA,MAAM,CAAC,iBAAD,EAAoBZ,WAApB,CAAN;AACAY,YAAAA,MAAM,CAAC,WAAD,EAAcM,MAAM,CAACpB,KAArB,CAAN;AACAc,YAAAA,MAAM,CAAC,UAAD,EAAaM,MAAb,CAAN;AACH,WAhBD,MAgBO;AACHH,YAAAA,MAAM,CAAC,IAAIiB,KAAJ,CAAU,iDAAV,CAAD,CAAN;AACH;;AAEDpB,UAAAA,MAAM,CAAC,UAAD,EAAaM,MAAM,CAACe,QAApB,CAAN;AACArB,UAAAA,MAAM,CAAC,aAAD,EAAgBpB,OAAO,EAAvB,CAAN;AACAoB,UAAAA,MAAM,CAAC,YAAD,EAAeM,MAAM,CAACrB,MAAtB,CAAN;AAEAiB,UAAAA,OAAO,CAACG,QAAD,CAAP;AACH,SA7BL,EA8BKM,KA9BL,CA8BW,UAAAC,KAAK,EAAI;AACZT,UAAAA,MAAM,CAACS,KAAD,CAAN;AACH,SAhCL;AAiCH,OAlCM,CAAP;AAmCH,KA1DI;AA4DL;AACAU,IAAAA,MA7DK,yBA+DF;AAAA,UADCtB,MACD,SADCA,MACD;AACC,aAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC1BzB,QAAAA,MAAM,GACD2B,IADL,CACU,YAAM;AACRF,UAAAA,OAAO;AACV,SAHL,EAIKS,KAJL,CAIW,UAACC,KAAD,EAAW;AACdV,UAAAA,OAAO,CAACU,KAAD,CAAP;AACH,SANL,EAOKW,OAPL,CAOa,YAAM;AACXvB,UAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACAA,UAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACAA,UAAAA,MAAM,CAAC,iBAAD,EAAoB,EAApB,CAAN;AACAzB,UAAAA,OAAO,CAACiD,MAAR,CAAe7C,YAAf;AACH,SAZL;AAaH,OAdM,CAAP;AAeH;AA/EI;AAnCA,CAAb;AAsHA,eAAeE,IAAf","sourcesContent":["import storage from 'store'\nimport {\n    login,\n    logout,\n    getInfo\n} from '@/api/login'\nimport {\n    ACCESS_TOKEN\n} from '@/store/mutation-types'\nimport {\n    welcome\n} from '@/utils/util'\n\nconst user = {\n    state: {\n        token: '',\n        name: '',\n        welcome: '',\n        avatar: '',\n        roles: [],\n        info: {},\n        permissions: []\n    },\n\n    mutations: {\n        SET_TOKEN: (state, token) => {\n            state.token = token\n        },\n        SET_NAME: (state, name) => {\n            state.name = name\n        },\n        SET_AVATAR: (state, avatar) => {\n            state.avatar = avatar\n        },\n        SET_ROLES: (state, roles) => {\n            state.roles = roles\n        },\n        SET_PERMISSIONS: (state, permissions) => {\n            state.permissions = permissions\n        },\n        SET_WELCOME: (state, welcome) => {\n            state.welcome = welcome\n        },\n        SET_INFO: (state, info) => {\n            state.info = info\n        }\n    },\n\n    actions: {\n        // 登录\n        Login({\n            commit\n        }, userInfo) {\n            return new Promise((resolve, reject) => {\n                login(userInfo)\n                    .then(response => {\n                        const result = response.data\n                        storage.set(ACCESS_TOKEN, result.access_token, result.expires_in)\n                        commit('SET_TOKEN', result.access_token)\n                        resolve()\n                    })\n                    .catch(error => {\n                        reject(error)\n                    })\n            })\n        },\n\n        // 获取用户信息\n        GetInfo({\n            commit\n        }) {\n            return new Promise((resolve, reject) => {\n                getInfo()\n                    .then(response => {\n                        const result = response.data\n\n                        if (result.permissions.length > 0) {\n                            let permissions = result.permissions\n\n                            permissions = permissions.map(per => {\n                                if (per.actionEntitySet != null && per.actionEntitySet.length > 0) {\n                                    const action = per.actionEntitySet.map(action => {\n                                        return action.action\n                                    })\n                                    per.actionList = action\n                                }\n                                return per\n                            })\n\n                            commit('SET_PERMISSIONS', permissions)\n                            commit('SET_ROLES', result.roles)\n                            commit('SET_INFO', result)\n                        } else {\n                            reject(new Error('getInfo: permissions must be a non-null array !'))\n                        }\n\n                        commit('SET_NAME', result.nickname)\n                        commit('SET_WELCOME', welcome())\n                        commit('SET_AVATAR', result.avatar)\n\n                        resolve(response)\n                    })\n                    .catch(error => {\n                        reject(error)\n                    })\n            })\n        },\n\n        // 登出\n        Logout({\n            commit\n        }) {\n            return new Promise(resolve => {\n                logout()\n                    .then(() => {\n                        resolve()\n                    })\n                    .catch((error) => {\n                        resolve(error)\n                    })\n                    .finally(() => {\n                        commit('SET_TOKEN', '')\n                        commit('SET_ROLES', [])\n                        commit('SET_PERMISSIONS', [])\n                        storage.remove(ACCESS_TOKEN)\n                    })\n            })\n        }\n    }\n}\n\nexport default user\n"]}]}