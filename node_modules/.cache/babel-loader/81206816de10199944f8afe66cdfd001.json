{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js!/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/alone/VueProjects/one-piece-vue/src/store/modules/user.js","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/store/modules/user.js","mtime":1596197339876},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js","mtime":1595422850086},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js","mtime":1595422972371}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgc3RvcmFnZSBmcm9tICdzdG9yZSc7CmltcG9ydCB7IGxvZ2luLCBnZXRJbmZvIH0gZnJvbSAnQC9hcGkvbG9naW4nOwppbXBvcnQgeyBBQ0NFU1NfVE9LRU4gfSBmcm9tICdAL3N0b3JlL211dGF0aW9uLXR5cGVzJzsKaW1wb3J0IHsgd2VsY29tZSB9IGZyb20gJ0AvdXRpbHMvdXRpbCc7CnZhciB1c2VyID0gewogIHN0YXRlOiB7CiAgICB0b2tlbjogJycsCiAgICBuYW1lOiAnJywKICAgIHdlbGNvbWU6ICcnLAogICAgYXZhdGFyOiAnJywKICAgIHJvbGVzOiBbXSwKICAgIGluZm86IHt9LAogICAgcGVybWlzc2lvbnM6IFtdCiAgfSwKICBtdXRhdGlvbnM6IHsKICAgIFNFVF9UT0tFTjogZnVuY3Rpb24gU0VUX1RPS0VOKHN0YXRlLCB0b2tlbikgewogICAgICBzdGF0ZS50b2tlbiA9IHRva2VuOwogICAgfSwKICAgIFNFVF9OQU1FOiBmdW5jdGlvbiBTRVRfTkFNRShzdGF0ZSwgX3JlZikgewogICAgICB2YXIgbmFtZSA9IF9yZWYubmFtZSwKICAgICAgICAgIHdlbGNvbWUgPSBfcmVmLndlbGNvbWU7CiAgICAgIHN0YXRlLm5hbWUgPSBuYW1lOwogICAgICBzdGF0ZS53ZWxjb21lID0gd2VsY29tZTsKICAgIH0sCiAgICBTRVRfQVZBVEFSOiBmdW5jdGlvbiBTRVRfQVZBVEFSKHN0YXRlLCBhdmF0YXIpIHsKICAgICAgc3RhdGUuYXZhdGFyID0gYXZhdGFyOwogICAgfSwKICAgIFNFVF9ST0xFUzogZnVuY3Rpb24gU0VUX1JPTEVTKHN0YXRlLCByb2xlcykgewogICAgICBzdGF0ZS5yb2xlcyA9IHJvbGVzOwogICAgfSwKICAgIFNFVF9QRVJNSVNTSU9OUzogZnVuY3Rpb24gU0VUX1BFUk1JU1NJT05TKHN0YXRlLCByb2xlcykgewogICAgICBzdGF0ZS5wZXJtaXNzaW9ucyA9IHJvbGVzOwogICAgfSwKICAgIFNFVF9JTkZPOiBmdW5jdGlvbiBTRVRfSU5GTyhzdGF0ZSwgaW5mbykgewogICAgICBzdGF0ZS5pbmZvID0gaW5mbzsKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIC8vIOeZu+W9lQogICAgTG9naW46IGZ1bmN0aW9uIExvZ2luKF9yZWYyLCB1c2VySW5mbykgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjIuY29tbWl0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGxvZ2luKHVzZXJJbmZvKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBzdG9yYWdlLnNldChBQ0NFU1NfVE9LRU4sIHJlc3VsdC5hY2Nlc3NfdG9rZW4sIHJlc3VsdC5leHBpcmVzX2luKTsKICAgICAgICAgIGNvbW1pdCgnU0VUX1RPS0VOJywgcmVzdWx0LmFjY2Vzc190b2tlbik7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDojrflj5bnlKjmiLfkv6Hmga8KICAgIEdldEluZm86IGZ1bmN0aW9uIEdldEluZm8oX3JlZjMpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYzLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBnZXRJbmZvKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0LnBlcm1pc3Npb25zKTsKCiAgICAgICAgICBpZiAocmVzdWx0LnBlcm1pc3Npb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gY29uc3Qgcm9sZSA9IHJlc3VsdC5yb2xlCiAgICAgICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IHJlc3VsdC5wZXJtaXNzaW9uczsKICAgICAgICAgICAgcGVybWlzc2lvbnMubWFwKGZ1bmN0aW9uIChwZXIpIHsKICAgICAgICAgICAgICBpZiAocGVyLmFjdGlvbkVudGl0eVNldCAhPSBudWxsICYmIHBlci5hY3Rpb25FbnRpdHlTZXQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHBlci5hY3Rpb25FbnRpdHlTZXQubWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbi5hY3Rpb247CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHBlci5hY3Rpb25MaXN0ID0gYWN0aW9uOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBwZXJtaXNzaW9uSWRzID0gcGVybWlzc2lvbnMubWFwKGZ1bmN0aW9uIChwZXJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHBlcm1pc3Npb24ucGVybWlzc2lvbklkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29tbWl0KCdTRVRfUEVSTUlTU0lPTlMnLCBwZXJtaXNzaW9uSWRzKTsKICAgICAgICAgICAgY29tbWl0KCdTRVRfUk9MRVMnLCByZXN1bHQucm9sZXMpOwogICAgICAgICAgICBjb21taXQoJ1NFVF9JTkZPJywgcmVzdWx0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ2dldEluZm86IHBlcm1pc3Npb25zIG11c3QgYmUgYSBub24tbnVsbCBhcnJheSAhJykpOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbW1pdCgnU0VUX05BTUUnLCB7CiAgICAgICAgICAgIG5hbWU6IHJlc3VsdC5uYW1lLAogICAgICAgICAgICB3ZWxjb21lOiB3ZWxjb21lKCkKICAgICAgICAgIH0pOwogICAgICAgICAgY29tbWl0KCdTRVRfQVZBVEFSJywgcmVzdWx0LmF2YXRhcik7CiAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOeZu+WHugogICAgLy8gTG9nb3V0ICh7IGNvbW1pdCwgc3RhdGUgfSkgewogICAgLy8gICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAvLyAgICAgbG9nb3V0KHN0YXRlLnRva2VuKQogICAgLy8gICAgICAgLnRoZW4oKCkgPT4gewogICAgLy8gICAgICAgICByZXNvbHZlKCkKICAgIC8vICAgICAgIH0pCiAgICAvLyAgICAgICAuY2F0Y2goKCkgPT4gewogICAgLy8gICAgICAgICByZXNvbHZlKCkKICAgIC8vICAgICAgIH0pCiAgICAvLyAgICAgICAuZmluYWxseSgoKSA9PiB7CiAgICAvLyAgICAgICAgIGNvbW1pdCgnU0VUX1RPS0VOJywgJycpCiAgICAvLyAgICAgICAgIGNvbW1pdCgnU0VUX1JPTEVTJywgW10pCiAgICAvLyAgICAgICAgIHN0b3JhZ2UucmVtb3ZlKEFDQ0VTU19UT0tFTikKICAgIC8vICAgICAgIH0pCiAgICAvLyAgIH0pCiAgICAvLyB9CiAgICBMb2dvdXQ6IGZ1bmN0aW9uIExvZ291dChfcmVmNCkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjQuY29tbWl0OwogICAgICBjb21taXQoJ1NFVF9UT0tFTicsICcnKTsKICAgICAgY29tbWl0KCdTRVRfUk9MRVMnLCBbXSk7CiAgICAgIGNvbW1pdCgnU0VUX1BFUk1JU1NJT05TJywgW10pOwogICAgICBzdG9yYWdlLnJlbW92ZShBQ0NFU1NfVE9LRU4pOwogICAgfQogIH0KfTsKZXhwb3J0IGRlZmF1bHQgdXNlcjs="},{"version":3,"sources":["/Users/alone/VueProjects/one-piece-vue/src/store/modules/user.js"],"names":["storage","login","getInfo","ACCESS_TOKEN","welcome","user","state","token","name","avatar","roles","info","permissions","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_PERMISSIONS","SET_INFO","actions","Login","userInfo","commit","Promise","resolve","reject","then","response","result","data","set","access_token","expires_in","catch","error","GetInfo","console","log","length","map","per","actionEntitySet","action","actionList","permissionIds","permission","permissionId","Error","Logout","remove"],"mappings":"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","sourcesContent":["import storage from 'store'\nimport {\n    login,\n    getInfo\n} from '@/api/login'\nimport {\n    ACCESS_TOKEN\n} from '@/store/mutation-types'\nimport {\n    welcome\n} from '@/utils/util'\n\nconst user = {\n    state: {\n        token: '',\n        name: '',\n        welcome: '',\n        avatar: '',\n        roles: [],\n        info: {},\n        permissions: []\n    },\n\n    mutations: {\n        SET_TOKEN: (state, token) => {\n            state.token = token\n        },\n        SET_NAME: (state, {\n            name,\n            welcome\n        }) => {\n            state.name = name\n            state.welcome = welcome\n        },\n        SET_AVATAR: (state, avatar) => {\n            state.avatar = avatar\n        },\n        SET_ROLES: (state, roles) => {\n            state.roles = roles\n        },\n        SET_PERMISSIONS: (state, roles) => {\n            state.permissions = roles\n        },\n        SET_INFO: (state, info) => {\n            state.info = info\n        }\n    },\n\n    actions: {\n        // 登录\n        Login({\n            commit\n        }, userInfo) {\n            return new Promise((resolve, reject) => {\n                login(userInfo)\n                    .then(response => {\n                        const result = response.data\n                        storage.set(ACCESS_TOKEN, result.access_token, result.expires_in)\n                        commit('SET_TOKEN', result.access_token)\n                        resolve()\n                    })\n                    .catch(error => {\n                        reject(error)\n                    })\n            })\n        },\n\n        // 获取用户信息\n        GetInfo({\n            commit\n        }) {\n            return new Promise((resolve, reject) => {\n                getInfo()\n                    .then(response => {\n                        const result = response.data\n                        console.log(result.permissions)\n\n                        if (result.permissions.length > 0) {\n                            // const role = result.role\n                            const permissions = result.permissions\n\n                            permissions.map(per => {\n                                if (per.actionEntitySet != null && per.actionEntitySet.length > 0) {\n                                    const action = per.actionEntitySet.map(action => {\n                                        return action.action\n                                    })\n                                    per.actionList = action\n                                }\n                            })\n\n                            const permissionIds = permissions.map(permission => {\n                                return permission.permissionId\n                            })\n\n                            commit('SET_PERMISSIONS', permissionIds)\n                            commit('SET_ROLES', result.roles)\n                            commit('SET_INFO', result)\n                        } else {\n                            reject(new Error('getInfo: permissions must be a non-null array !'))\n                        }\n\n                        commit('SET_NAME', {\n                            name: result.name,\n                            welcome: welcome()\n                        })\n                        commit('SET_AVATAR', result.avatar)\n\n                        resolve(response)\n                    })\n                    .catch(error => {\n                        reject(error)\n                    })\n            })\n        },\n\n        // 登出\n        // Logout ({ commit, state }) {\n        //   return new Promise(resolve => {\n        //     logout(state.token)\n        //       .then(() => {\n        //         resolve()\n        //       })\n        //       .catch(() => {\n        //         resolve()\n        //       })\n        //       .finally(() => {\n        //         commit('SET_TOKEN', '')\n        //         commit('SET_ROLES', [])\n        //         storage.remove(ACCESS_TOKEN)\n        //       })\n        //   })\n        // }\n\n        Logout({\n            commit\n        }) {\n            commit('SET_TOKEN', '')\n            commit('SET_ROLES', [])\n            commit('SET_PERMISSIONS', [])\n            storage.remove(ACCESS_TOKEN)\n        }\n\n    }\n}\n\nexport default user\n"]}]}