{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js!/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/alone/VueProjects/one-piece-vue/src/store/modules/permission.js","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/store/modules/permission.js","mtime":1596296347331},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js","mtime":1595422850086},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js","mtime":1595422972371}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2Fsb25lL1Z1ZVByb2plY3RzL29uZS1waWVjZS12dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgeyBjb25zdGFudFJvdXRlck1hcCB9IGZyb20gJ0AvY29uZmlnL3JvdXRlci5jb25maWcnOwppbXBvcnQgeyBDb21wb25lbnRzIH0gZnJvbSAnQC9jb25maWcvY29tcG9uZW50Q29uZmlncyc7CmltcG9ydCByb3V0ZXIsIHsgcmVzZXRSb3V0ZXIgfSBmcm9tICdAL3JvdXRlcic7CmltcG9ydCBtZXNzYWdlIGZyb20gJ2FudC1kZXNpZ24tdnVlL2VzL21lc3NhZ2UnOwovKioKICog6L+H5ruk6LSm5oi35piv5ZCm5oul5pyJ5p+Q5LiA5Liq5p2D6ZmQ77yM5bm25bCG6I+c5Y2V5LuO5Yqg6L295YiX6KGo56e76ZmkCiAqCiAqIEBwYXJhbSBwZXJtaXNzaW9uCiAqIEBwYXJhbSByb3V0ZQogKiBAcmV0dXJucyB7Ym9vbGVhbn0KICovCgpmdW5jdGlvbiBoYXNQZXJtaXNzaW9uKHBlcm1pc3Npb24sIHJvdXRlKSB7CiAgaWYgKHJvdXRlLm1ldGEgJiYgcm91dGUubWV0YS5wZXJtaXNzaW9uKSB7CiAgICB2YXIgZmxhZyA9IGZhbHNlOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwZXJtaXNzaW9uLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGZsYWcgPSByb3V0ZS5tZXRhLnBlcm1pc3Npb24uaW5jbHVkZXMocGVybWlzc2lvbltpXS5wZXJtaXNzaW9uSWQpOwoKICAgICAgaWYgKGZsYWcpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiB0cnVlOwp9Ci8qKgogKiDljZXotKbmiLflpJrop5LoibLml7bvvIzkvb/nlKjor6Xmlrnms5Xlj6/ov4fmu6Top5LoibLkuI3lrZjlnKjnmoToj5zljZUKICoKICogQHBhcmFtIHJvbGVzCiAqIEBwYXJhbSByb3V0ZQogKiBAcmV0dXJucyB7Kn0KICovCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQoKCmZ1bmN0aW9uIGhhc1JvbGUocm9sZXMsIHJvdXRlKSB7CiAgaWYgKHJvdXRlLm1ldGEgJiYgcm91dGUubWV0YS5yb2xlcykgewogICAgcmV0dXJuIHJvdXRlLm1ldGEucm9sZXMuaW5jbHVkZXMocm9sZXMuaWQpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmZ1bmN0aW9uIGZpbHRlckFzeW5jUm91dGVyKHJvdXRlck1hcCwgcGVybWlzc2lvbnMpIHsKICBjb25zb2xlLmxvZyhDb21wb25lbnRzKTsKICB2YXIgY29tcG9uZW50cyA9IHt9OwoKICBmb3IgKHZhciB0eXBlIGluIENvbXBvbmVudHMpIHsKICAgIGNvbXBvbmVudHMgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIENvbXBvbmVudHNbdHlwZV0pLCBjb21wb25lbnRzKTsKICB9CgogIGNvbnNvbGUubG9nKGNvbXBvbmVudHMpOwogIHZhciBhY2Nlc3NlZFJvdXRlcnMgPSByb3V0ZXJNYXAuZmlsdGVyKGZ1bmN0aW9uIChyb3V0ZSkgewogICAgaWYgKGhhc1Blcm1pc3Npb24ocGVybWlzc2lvbnMsIHJvdXRlKSkgewogICAgICByb3V0ZS5jb21wb25lbnQgPSBjb21wb25lbnRzW3JvdXRlLmNvbXBvbmVudF07CgogICAgICBpZiAocm91dGUuY2hpbGRyZW4gJiYgcm91dGUuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgcm91dGUuY2hpbGRyZW4gPSBmaWx0ZXJBc3luY1JvdXRlcihyb3V0ZS5jaGlsZHJlbiwgcGVybWlzc2lvbnMpOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfSk7CiAgcmV0dXJuIGFjY2Vzc2VkUm91dGVyczsKfQoKdmFyIHBlcm1pc3Npb24gPSB7CiAgc3RhdGU6IHsKICAgIHJvdXRlcnM6IGNvbnN0YW50Um91dGVyTWFwLAogICAgYWRkUm91dGVyczogW10KICB9LAogIG11dGF0aW9uczogewogICAgU0VUX1JPVVRFUlM6IGZ1bmN0aW9uIFNFVF9ST1VURVJTKHN0YXRlLCByb3V0ZXJzKSB7CiAgICAgIHN0YXRlLmFkZFJvdXRlcnMgPSByb3V0ZXJzOwogICAgICBzdGF0ZS5yb3V0ZXJzID0gY29uc3RhbnRSb3V0ZXJNYXAuY29uY2F0KHJvdXRlcnMpOwogICAgfQogIH0sCiAgYWN0aW9uczogewogICAgR2VuZXJhdGVSb3V0ZXM6IGZ1bmN0aW9uIEdlbmVyYXRlUm91dGVzKF9yZWYsIGRhdGEpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYuY29tbWl0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBkYXRhLnBlcm1pc3Npb25zLAogICAgICAgICAgICBtZW51cyA9IGRhdGEubWVudXM7CiAgICAgICAgdmFyIGFjY2Vzc2VkUm91dGVycyA9IGZpbHRlckFzeW5jUm91dGVyKG1lbnVzLCBwZXJtaXNzaW9ucyk7CiAgICAgICAgdmFyIG5vdEZvdW5kUm91dGVyID0gewogICAgICAgICAgcGF0aDogJyonLAogICAgICAgICAgcmVkaXJlY3Q6ICcvNDA0JywKICAgICAgICAgIGhpZGRlbjogdHJ1ZQogICAgICAgIH07CiAgICAgICAgYWNjZXNzZWRSb3V0ZXJzLnB1c2gobm90Rm91bmRSb3V0ZXIpOwogICAgICAgIGNvbnNvbGUubG9nKGFjY2Vzc2VkUm91dGVycyk7CiAgICAgICAgY29tbWl0KCdTRVRfUk9VVEVSUycsIGFjY2Vzc2VkUm91dGVycyk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICBSZWxvYWRSb3V0ZXJzOiBmdW5jdGlvbiBSZWxvYWRSb3V0ZXJzKHN0b3JlKSB7CiAgICAgIHZhciBoaWRlID0gbWVzc2FnZS5sb2FkaW5nKCfmraPlnKjliLfmlrDot6/nlLEuLi4nKTsKICAgICAgc3RvcmUuZGlzcGF0Y2goJ0dldEluZm8nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICB2YXIgcm9sZXMgPSByZXMucmVzdWx0ICYmIHJlcy5yZXN1bHQucm9sZTsKICAgICAgICB2YXIgbWVudXMgPSByZXMucmVzdWx0ICYmIHJlcy5yZXN1bHQubWVudXM7CiAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ0dlbmVyYXRlUm91dGVzJywgewogICAgICAgICAgcm9sZXM6IHJvbGVzLAogICAgICAgICAgbWVudXM6IG1lbnVzCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXNldFJvdXRlcigpOwogICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhzdG9yZS5nZXR0ZXJzLmFkZFJvdXRlcnMpOwogICAgICAgICAgaGlkZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9Cn07CmV4cG9ydCBkZWZhdWx0IHBlcm1pc3Npb247"},{"version":3,"sources":["/Users/alone/VueProjects/one-piece-vue/src/store/modules/permission.js"],"names":["constantRouterMap","Components","router","resetRouter","message","hasPermission","permission","route","meta","flag","i","len","length","includes","permissionId","hasRole","roles","id","filterAsyncRouter","routerMap","permissions","console","log","components","type","accessedRouters","filter","component","children","state","routers","addRouters","mutations","SET_ROUTERS","concat","actions","GenerateRoutes","data","commit","Promise","resolve","menus","notFoundRouter","path","redirect","hidden","push","ReloadRouters","store","hide","loading","dispatch","then","res","result","role","addRoutes","getters"],"mappings":"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","sourcesContent":["import {\n    constantRouterMap\n} from '@/config/router.config'\nimport {\n    Components\n} from '@/config/componentConfigs'\nimport router, {\n    resetRouter\n} from '@/router'\nimport message from 'ant-design-vue/es/message'\n/**\n * 过滤账户是否拥有某一个权限，并将菜单从加载列表移除\n *\n * @param permission\n * @param route\n * @returns {boolean}\n */\nfunction hasPermission(permission, route) {\n    if (route.meta && route.meta.permission) {\n        let flag = false\n        for (let i = 0, len = permission.length; i < len; i++) {\n            flag = route.meta.permission.includes(permission[i].permissionId)\n            if (flag) {\n                return true\n            }\n        }\n        return false\n    }\n    return true\n}\n\n/**\n * 单账户多角色时，使用该方法可过滤角色不存在的菜单\n *\n * @param roles\n * @param route\n * @returns {*}\n */\n// eslint-disable-next-line\nfunction hasRole(roles, route) {\n    if (route.meta && route.meta.roles) {\n        return route.meta.roles.includes(roles.id)\n    } else {\n        return true\n    }\n}\n\nfunction filterAsyncRouter(routerMap, permissions) {\n    console.log(Components)\n    let components = {}\n    for (const type in Components) {\n        components = {\n            ...Components[type],\n            ...components\n        }\n    }\n    console.log(components)\n    const accessedRouters = routerMap.filter(route => {\n        if (hasPermission(permissions, route)) {\n            route.component = components[route.component]\n            if (route.children && route.children.length) {\n                route.children = filterAsyncRouter(route.children, permissions)\n            }\n            return true\n        }\n        return false\n    })\n\n    return accessedRouters\n}\n\nconst permission = {\n    state: {\n        routers: constantRouterMap,\n        addRouters: []\n    },\n    mutations: {\n        SET_ROUTERS: (state, routers) => {\n            state.addRouters = routers\n            state.routers = constantRouterMap.concat(routers)\n        }\n    },\n    actions: {\n        GenerateRoutes({\n            commit\n        }, data) {\n            return new Promise(resolve => {\n                const {\n                    permissions,\n                    menus\n                } = data\n\n                const accessedRouters = filterAsyncRouter(menus, permissions)\n                const notFoundRouter = {\n                    path: '*',\n                    redirect: '/404',\n                    hidden: true\n                }\n                accessedRouters.push(notFoundRouter)\n                console.log(accessedRouters)\n                commit('SET_ROUTERS', accessedRouters)\n                resolve()\n            })\n        },\n        ReloadRouters(store) {\n            const hide = message.loading('正在刷新路由...')\n            store.dispatch('GetInfo').then(res => {\n                const roles = res.result && res.result.role\n                const menus = res.result && res.result.menus\n                store.dispatch('GenerateRoutes', {\n                    roles,\n                    menus\n                }).then(() => {\n                    resetRouter()\n                    router.addRoutes(store.getters.addRouters)\n                    hide()\n                })\n            })\n        }\n    }\n}\n\nexport default permission\n"]}]}