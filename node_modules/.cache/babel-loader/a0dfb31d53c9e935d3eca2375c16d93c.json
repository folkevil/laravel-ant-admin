{"remainingRequest":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js!/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/alone/VueProjects/one-piece-vue/src/store/modules/permission.js","dependencies":[{"path":"/Users/alone/VueProjects/one-piece-vue/src/store/modules/permission.js","mtime":1596205474772},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/cache-loader/dist/cjs.js","mtime":1595422850119},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/babel-loader/lib/index.js","mtime":1595422850086},{"path":"/Users/alone/VueProjects/one-piece-vue/node_modules/eslint-loader/index.js","mtime":1595422972371}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2Fsb25lL1Z1ZVByb2plY3RzL29uZS1waWVjZS12dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgeyBjb25zdGFudFJvdXRlck1hcCB9IGZyb20gJ0AvY29uZmlnL3JvdXRlci5jb25maWcnOwppbXBvcnQgeyBDb21wb25lbnRzIH0gZnJvbSAnQC9jb25maWcvY29tcG9uZW50Q29uZmlncyc7CmltcG9ydCByb3V0ZXIsIHsgcmVzZXRSb3V0ZXIgfSBmcm9tICdAL3JvdXRlcic7CmltcG9ydCBtZXNzYWdlIGZyb20gJ2FudC1kZXNpZ24tdnVlL2VzL21lc3NhZ2UnOwovKioKICog6L+H5ruk6LSm5oi35piv5ZCm5oul5pyJ5p+Q5LiA5Liq5p2D6ZmQ77yM5bm25bCG6I+c5Y2V5LuO5Yqg6L295YiX6KGo56e76ZmkCiAqCiAqIEBwYXJhbSBwZXJtaXNzaW9uCiAqIEBwYXJhbSByb3V0ZQogKiBAcmV0dXJucyB7Ym9vbGVhbn0KICovCgpmdW5jdGlvbiBoYXNQZXJtaXNzaW9uKHBlcm1pc3Npb24sIHJvdXRlKSB7CiAgaWYgKHJvdXRlLm1ldGEgJiYgcm91dGUubWV0YS5wZXJtaXNzaW9uKSB7CiAgICB2YXIgZmxhZyA9IGZhbHNlOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwZXJtaXNzaW9uLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGZsYWcgPSByb3V0ZS5tZXRhLnBlcm1pc3Npb24uaW5jbHVkZXMocGVybWlzc2lvbltpXSk7CgogICAgICBpZiAoZmxhZykgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIHRydWU7Cn0KLyoqCiAqIOWNlei0puaIt+WkmuinkuiJsuaXtu+8jOS9v+eUqOivpeaWueazleWPr+i/h+a7pOinkuiJsuS4jeWtmOWcqOeahOiPnOWNlQogKgogKiBAcGFyYW0gcm9sZXMKICogQHBhcmFtIHJvdXRlCiAqIEByZXR1cm5zIHsqfQogKi8KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCgoKZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgcm91dGUpIHsKICBpZiAocm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLnJvbGVzKSB7CiAgICByZXR1cm4gcm91dGUubWV0YS5yb2xlcy5pbmNsdWRlcyhyb2xlcy5pZCk7CiAgfSBlbHNlIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKZnVuY3Rpb24gZmlsdGVyQXN5bmNSb3V0ZXIocm91dGVyTWFwLCBwZXJtaXNzaW9ucykgewogIHZhciBjb21wb25lbnRzID0ge307CgogIGZvciAodmFyIHR5cGUgaW4gQ29tcG9uZW50cykgewogICAgY29tcG9uZW50cyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgQ29tcG9uZW50c1t0eXBlXSksIGNvbXBvbmVudHMpOwogIH0KCiAgdmFyIGFjY2Vzc2VkUm91dGVycyA9IHJvdXRlck1hcC5maWx0ZXIoZnVuY3Rpb24gKHJvdXRlKSB7CiAgICBpZiAoaGFzUGVybWlzc2lvbihwZXJtaXNzaW9ucywgcm91dGUpKSB7CiAgICAgIHJvdXRlLmNvbXBvbmVudCA9IGNvbXBvbmVudHNbcm91dGUuY29tcG9uZW50XTsKCiAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICByb3V0ZS5jaGlsZHJlbiA9IGZpbHRlckFzeW5jUm91dGVyKHJvdXRlLmNoaWxkcmVuLCBwZXJtaXNzaW9ucyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9KTsKICByZXR1cm4gYWNjZXNzZWRSb3V0ZXJzOwp9Cgp2YXIgcGVybWlzc2lvbiA9IHsKICBzdGF0ZTogewogICAgcm91dGVyczogY29uc3RhbnRSb3V0ZXJNYXAsCiAgICBhZGRSb3V0ZXJzOiBbXQogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBTRVRfUk9VVEVSUzogZnVuY3Rpb24gU0VUX1JPVVRFUlMoc3RhdGUsIHJvdXRlcnMpIHsKICAgICAgc3RhdGUuYWRkUm91dGVycyA9IHJvdXRlcnM7CiAgICAgIHN0YXRlLnJvdXRlcnMgPSBjb25zdGFudFJvdXRlck1hcC5jb25jYXQocm91dGVycyk7CiAgICB9CiAgfSwKICBhY3Rpb25zOiB7CiAgICBHZW5lcmF0ZVJvdXRlczogZnVuY3Rpb24gR2VuZXJhdGVSb3V0ZXMoX3JlZiwgZGF0YSkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZi5jb21taXQ7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IGRhdGEucGVybWlzc2lvbnMsCiAgICAgICAgICAgIG1lbnVzID0gZGF0YS5tZW51czsKICAgICAgICB2YXIgYWNjZXNzZWRSb3V0ZXJzID0gZmlsdGVyQXN5bmNSb3V0ZXIobWVudXMsIHBlcm1pc3Npb25zKTsKICAgICAgICB2YXIgbm90Rm91bmRSb3V0ZXIgPSB7CiAgICAgICAgICBwYXRoOiAnKicsCiAgICAgICAgICByZWRpcmVjdDogJy80MDQnLAogICAgICAgICAgaGlkZGVuOiB0cnVlCiAgICAgICAgfTsKICAgICAgICBhY2Nlc3NlZFJvdXRlcnMucHVzaChub3RGb3VuZFJvdXRlcik7CiAgICAgICAgY29tbWl0KCdTRVRfUk9VVEVSUycsIGFjY2Vzc2VkUm91dGVycyk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICBSZWxvYWRSb3V0ZXJzOiBmdW5jdGlvbiBSZWxvYWRSb3V0ZXJzKHN0b3JlKSB7CiAgICAgIHZhciBoaWRlID0gbWVzc2FnZS5sb2FkaW5nKCfmraPlnKjliLfmlrDot6/nlLEuLi4nKTsKICAgICAgc3RvcmUuZGlzcGF0Y2goJ0dldEluZm8nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICB2YXIgcm9sZXMgPSByZXMucmVzdWx0ICYmIHJlcy5yZXN1bHQucm9sZTsKICAgICAgICB2YXIgbWVudXMgPSByZXMucmVzdWx0ICYmIHJlcy5yZXN1bHQubWVudXM7CiAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ0dlbmVyYXRlUm91dGVzJywgewogICAgICAgICAgcm9sZXM6IHJvbGVzLAogICAgICAgICAgbWVudXM6IG1lbnVzCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXNldFJvdXRlcigpOwogICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhzdG9yZS5nZXR0ZXJzLmFkZFJvdXRlcnMpOwogICAgICAgICAgaGlkZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9Cn07CmV4cG9ydCBkZWZhdWx0IHBlcm1pc3Npb247"},{"version":3,"sources":["/Users/alone/VueProjects/one-piece-vue/src/store/modules/permission.js"],"names":["constantRouterMap","Components","router","resetRouter","message","hasPermission","permission","route","meta","flag","i","len","length","includes","hasRole","roles","id","filterAsyncRouter","routerMap","permissions","components","type","accessedRouters","filter","component","children","state","routers","addRouters","mutations","SET_ROUTERS","concat","actions","GenerateRoutes","data","commit","Promise","resolve","menus","notFoundRouter","path","redirect","hidden","push","ReloadRouters","store","hide","loading","dispatch","then","res","result","role","addRoutes","getters"],"mappings":"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","sourcesContent":["import {\n    constantRouterMap\n} from '@/config/router.config'\nimport {\n    Components\n} from '@/config/componentConfigs'\nimport router, {\n    resetRouter\n} from '@/router'\nimport message from 'ant-design-vue/es/message'\n/**\n * 过滤账户是否拥有某一个权限，并将菜单从加载列表移除\n *\n * @param permission\n * @param route\n * @returns {boolean}\n */\nfunction hasPermission(permission, route) {\n    if (route.meta && route.meta.permission) {\n        let flag = false\n        for (let i = 0, len = permission.length; i < len; i++) {\n            flag = route.meta.permission.includes(permission[i])\n            if (flag) {\n                return true\n            }\n        }\n        return false\n    }\n    return true\n}\n\n/**\n * 单账户多角色时，使用该方法可过滤角色不存在的菜单\n *\n * @param roles\n * @param route\n * @returns {*}\n */\n// eslint-disable-next-line\nfunction hasRole(roles, route) {\n    if (route.meta && route.meta.roles) {\n        return route.meta.roles.includes(roles.id)\n    } else {\n        return true\n    }\n}\n\nfunction filterAsyncRouter(routerMap, permissions) {\n    let components = {}\n    for (const type in Components) {\n        components = {\n            ...Components[type],\n            ...components\n        }\n    }\n    const accessedRouters = routerMap.filter(route => {\n        if (hasPermission(permissions, route)) {\n            route.component = components[route.component]\n            if (route.children && route.children.length) {\n                route.children = filterAsyncRouter(route.children, permissions)\n            }\n            return true\n        }\n        return false\n    })\n    return accessedRouters\n}\n\nconst permission = {\n    state: {\n        routers: constantRouterMap,\n        addRouters: []\n    },\n    mutations: {\n        SET_ROUTERS: (state, routers) => {\n            state.addRouters = routers\n            state.routers = constantRouterMap.concat(routers)\n        }\n    },\n    actions: {\n        GenerateRoutes({\n            commit\n        }, data) {\n            return new Promise(resolve => {\n                const {\n                    permissions,\n                    menus\n                } = data\n\n                const accessedRouters = filterAsyncRouter(menus, permissions)\n                const notFoundRouter = {\n                    path: '*',\n                    redirect: '/404',\n                    hidden: true\n                }\n                accessedRouters.push(notFoundRouter)\n                commit('SET_ROUTERS', accessedRouters)\n                resolve()\n            })\n        },\n        ReloadRouters(store) {\n            const hide = message.loading('正在刷新路由...')\n            store.dispatch('GetInfo').then(res => {\n                const roles = res.result && res.result.role\n                const menus = res.result && res.result.menus\n                store.dispatch('GenerateRoutes', {\n                    roles,\n                    menus\n                }).then(() => {\n                    resetRouter()\n                    router.addRoutes(store.getters.addRouters)\n                    hide()\n                })\n            })\n        }\n    }\n}\n\nexport default permission\n"]}]}